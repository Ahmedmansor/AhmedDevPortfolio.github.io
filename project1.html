<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title data-i18n-key="project1Page.pageTitle"></title>
    <link rel="stylesheet" href="style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Montserrat:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
  </head>

  <body id="project1-page">
    <!-- Sticky Feature Navigation Bar -->
    <nav class="feature-nav" id="feature-nav">
      <ul></ul>
    </nav>
    <template id="gallery-item-template">
      <div class="gallery-item">
        <p class="media-caption"></p>
        <button class="see-more-btn" data-i18n-key="common.seeMore"></button>
        <video autoplay loop muted playsinline>
          <source src="" type="video/mp4" />
          Your browser does not support the video tag.
        </video>
      </div>
    </template>

    <div class="container">
      <header class="project-detail-header">
        <div class="language-switcher">
          <button id="lang-en-btn">English</button>
          <button id="lang-ar-btn">العربية</button>
        </div>
        <h1 data-i18n-key="project1Page.headerTitle"></h1>
        <p data-i18n-key="project1Page.headerDescription"></p>
      </header>

      <main class="project-detail-content">
        <div class="feature-spotlight" id="feature1">
          <h4 data-i18n-key="project1Page.feature1Title"></h4>
          <p
            class="feature-description"
            data-i18n-key="project1Page.feature1Description"
          ></p>
          <div class="feature-media-gallery" id="login-gallery"></div>
        </div>
        <div class="feature-spotlight" id="feature2">
          <h4 data-i18n-key="project1Page.feature2Title"></h4>
          <p
            class="feature-description"
            data-i18n-key="project1Page.feature2Description"
          ></p>
          <div class="feature-media-gallery" id="registration-gallery"></div>
        </div>
        <div class="feature-spotlight" id="feature3">
          <h4 data-i18n-key="project1Page.feature3Title"></h4>
          <p
            class="feature-description"
            data-i18n-key="project1Page.feature3Description"
          ></p>
          <div class="feature-media-gallery" id="profiles-gallery"></div>
          <div class="side-by-side-container">
            <h5 data-i18n-key="project1Page.feature3ComparisonTitle"></h5>
            <p data-i18n-key="project1Page.feature3ComparisonDescription"></p>
            <img
              src="assets/images/all-profiles-comparison.jpg"
              alt="Side-by-side comparison"
            />
          </div>
        </div>
        <div class="feature-spotlight" id="feature4">
          <h4 data-i18n-key="project1Page.feature4Title"></h4>
          <p
            class="feature-description"
            data-i18n-key="project1Page.feature4Description"
          ></p>
          <div class="feature-media-gallery" id="search-filter-gallery"></div>
        </div>
        <div class="feature-spotlight" id="feature5">
          <h4 data-i18n-key="project1Page.feature5Title"></h4>
          <p
            class="feature-description"
            data-i18n-key="project1Page.feature5Description"
          ></p>
          <div class="feature-media-gallery" id="become-coach-gallery"></div>
        </div>
        <div class="feature-spotlight" id="feature6">
          <h4 data-i18n-key="project1Page.feature6Title"></h4>
          <p
            class="feature-description"
            data-i18n-key="project1Page.feature6Description"
          ></p>
          <div class="feature-media-gallery" id="session-gallery">
            <div class="gallery-item">
              <p
                class="media-caption"
                data-i18n-key="project1Page.staticImageData.sessionSync.caption"
              ></p>
              <button
                class="see-more-btn"
                data-i18n-key="common.seeMore"
              ></button>
              <img
                src="assets/images/linker-players-Joined.jpg"
                alt="Screenshot of coach's view"
              />
            </div>
          </div>
        </div>
      </main>

      <a
        href="index.html"
        class="back-to-home-link"
        data-i18n-key="common.backToHome"
      ></a>
    </div>

    <script>
      // Sticky Feature Navigation Bar Logic (with translation)
      function buildFeatureNav() {
        const nav = document.getElementById("feature-nav");
        const ul = nav.querySelector("ul");
        ul.innerHTML = "";
        const titles = (translations.project1Page &&
          translations.project1Page.featureNavTitles) || [
          "Secure and Easy Login and Logout System",
          "User Registration with Robust Validation",
          "The Complete User Journey: Guest, Player & Coach Views",
          "Advanced Search & Multi-Factor Filtering",
          "Full-Circle Application: From Player to Coach",
          "Core Interaction: Session Creation & Enrollment",
        ];
        titles.forEach((title, i) => {
          const li = document.createElement("li");
          const a = document.createElement("a");
          a.href = `#feature${i + 1}`;
          a.setAttribute("data-feature", i + 1);
          a.textContent = `${i + 1}. ${title}`;
          li.appendChild(a);
          ul.appendChild(li);
        });
      }

      function setupFeatureNavLogic() {
        const nav = document.getElementById("feature-nav");
        const navLinks = nav.querySelectorAll("a");
        const featureSections = Array.from({ length: 6 }, (_, i) =>
          document.getElementById(`feature${i + 1}`)
        );

        // Smooth scroll
        navLinks.forEach((link) => {
          link.addEventListener("click", function (e) {
            e.preventDefault();
            const targetId = this.getAttribute("href").replace("#", "");
            const target = document.getElementById(targetId);
            if (target) {
              const navHeight = nav.offsetHeight;
              const rect = target.getBoundingClientRect();
              const scrollTop =
                window.pageYOffset || document.documentElement.scrollTop;
              // Offset for sticky nav
              const top = rect.top + scrollTop - navHeight - 10;
              window.scrollTo({ top, behavior: "smooth" });
            }
          });
        });

        // Highlight active nav item on scroll
        function onScroll() {
          const navHeight = nav.offsetHeight;
          let current = 0;
          featureSections.forEach((section, idx) => {
            if (section) {
              const sectionTop =
                section.getBoundingClientRect().top - navHeight - 20;
              if (sectionTop <= 0) current = idx;
            }
          });
          navLinks.forEach((link, idx) => {
            if (idx === current) {
              link.classList.add("active");
            } else {
              link.classList.remove("active");
            }
          });
        }
        window.addEventListener("scroll", onScroll);
        onScroll();
      }

      document.addEventListener("DOMContentLoaded", function () {
        buildFeatureNav();
        setupFeatureNavLogic();
      });
      let translations = {};

      function translatePage() {
        if (!translations || Object.keys(translations).length === 0) return;
        const currentLang = localStorage.getItem("lang") || "en";
        document.documentElement.lang = currentLang;
        document.documentElement.dir = currentLang === "ar" ? "rtl" : "ltr";

        const pageId = document.body.id;
        let pageKey = pageId === "index-page" ? "indexPage" : "project1Page";

        document.querySelectorAll("[data-i18n-key]").forEach((element) => {
          const fullKey = element.getAttribute("data-i18n-key");
          let value;
          // Check for common keys first
          if (fullKey.startsWith("common.")) {
            value = translations.common[fullKey.replace("common.", "")];
          } else {
            const key = fullKey.replace(pageKey + ".", "");
            value = key
              .split(".")
              .reduce(
                (obj, k) => (obj && obj[k] !== undefined ? obj[k] : undefined),
                translations[pageKey]
              );
          }
          if (value !== undefined) element.innerHTML = value;
        });

        if (pageId === "project1-page") {
          // Rebuild feature nav with translated titles
          buildFeatureNav();
          setupFeatureNavLogic();
          document
            .querySelectorAll(".feature-media-gallery")
            .forEach((gallery) => (gallery.innerHTML = ""));
          const sessionGallery = document.getElementById("session-gallery");
          if (sessionGallery) {
            sessionGallery.innerHTML = `<div class="gallery-item">
                        <p class="media-caption" data-i18n-key="project1Page.staticImageData.sessionSync.caption">${translations.project1Page.staticImageData.sessionSync.caption}</p>
                        <button class="see-more-btn" data-i18n-key="common.seeMore">${translations.common.seeMore}</button>
                        <img src="assets/images/linker-players-Joined.jpg" alt="Screenshot of the coach's view" />
                    </div>`;
          }

          createGallery(
            "login-gallery",
            translations.project1Page.loginGalleryData || []
          );
          createGallery(
            "registration-gallery",
            translations.project1Page.registrationGalleryData || []
          );
          createGallery(
            "profiles-gallery",
            translations.project1Page.profilesGalleryData || []
          );
          createGallery(
            "search-filter-gallery",
            translations.project1Page.searchFilterGalleryData || []
          );
          createGallery(
            "become-coach-gallery",
            translations.project1Page.becomeCoachGalleryData || []
          );
          createGallery(
            "session-gallery",
            translations.project1Page.sessionGalleryData || []
          );
          applySeeMoreLogic();
        }
      }

      function loadLanguage(lang) {
        const oldScript = document.getElementById("lang-script");
        if (oldScript) oldScript.remove();

        const script = document.createElement("script");
        script.id = "lang-script";
        script.src = `lang/${lang}.js`;
        script.onload = () => {
          localStorage.setItem("lang", lang);
          translatePage();
        };
        script.onerror = () =>
          console.error(`Failed to load language file: ${script.src}`);
        document.head.appendChild(script);
      }

      function createGallery(containerId, data) {
        const galleryContainer = document.getElementById(containerId);
        if (!galleryContainer || !data) return;
        const CHARACTER_LIMIT = 110;
        data.forEach((itemData) => {
          // Create gallery-item div
          const itemDiv = document.createElement("div");
          itemDiv.className = "gallery-item";

          // Caption
          const captionP = document.createElement("p");
          captionP.className = "media-caption";
          captionP.innerHTML = itemData.caption;
          itemDiv.appendChild(captionP);

          // See more button only if caption is long
          if (captionP.textContent.length > CHARACTER_LIMIT) {
            const seeMoreBtn = document.createElement("button");
            seeMoreBtn.className = "see-more-btn";
            seeMoreBtn.setAttribute("data-i18n-key", "common.seeMore");
            seeMoreBtn.textContent =
              translations.common && translations.common.seeMore
                ? translations.common.seeMore
                : "See More";
            itemDiv.appendChild(seeMoreBtn);
          }

          // Video
          if (itemData.videoSrc) {
            const video = document.createElement("video");
            video.autoplay = true;
            video.loop = true;
            video.muted = true;
            video.playsInline = true;
            const source = document.createElement("source");
            source.src = itemData.videoSrc;
            source.type = "video/mp4";
            video.appendChild(source);
            video.innerHTML += "Your browser does not support the video tag.";
            itemDiv.appendChild(video);
          }
          galleryContainer.appendChild(itemDiv);
        });
      }

      function applySeeMoreLogic() {
        const CHARACTER_LIMIT = 110;
        const galleryItems = document.querySelectorAll(".gallery-item");
        galleryItems.forEach((item) => {
          const caption = item.querySelector(".media-caption");
          const button = item.querySelector(".see-more-btn");
          if (!button) return;

          if (button.hasAttribute("data-listener-added")) return;

          // Only show button if caption is long
          button.style.visibility =
            caption.textContent.length > CHARACTER_LIMIT ? "visible" : "hidden";
          caption.classList.remove("truncated");

          if (caption.textContent.length > CHARACTER_LIMIT) {
            caption.classList.add("truncated");
          }
          button.addEventListener("click", () => {
            caption.classList.toggle("truncated");
            button.textContent = caption.classList.contains("truncated")
              ? translations.common.seeMore || "See More"
              : translations.common.seeLess || "See Less";
          });
          button.setAttribute("data-listener-added", "true");
        });
      }

      function setActiveLangButton(lang) {
        const enBtn = document.getElementById("lang-en-btn");
        const arBtn = document.getElementById("lang-ar-btn");
        enBtn.classList.toggle("active", lang === "en");
        arBtn.classList.toggle("active", lang === "ar");
      }

      document.getElementById("lang-en-btn").addEventListener("click", () => {
        setActiveLangButton("en");
        loadLanguage("en");
      });
      document.getElementById("lang-ar-btn").addEventListener("click", () => {
        setActiveLangButton("ar");
        loadLanguage("ar");
      });

      // Set initial active button
      setActiveLangButton(localStorage.getItem("lang") || "en");
      loadLanguage(localStorage.getItem("lang") || "en");
    </script>
    <style>
      .feature-nav {
        position: sticky;
        top: 0;
        z-index: 100;
        background: #181818;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.18);
        padding: 0;
        margin-bottom: 30px;
        border-bottom: 2px solid #03dac6;
      }
      .feature-nav ul {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 0px 18px;
        list-style: none;
        margin: 0;
        padding: 0 0 0 0;
        max-width: 1100px;
        margin-left: auto;
        margin-right: auto;
      }
      .feature-nav li {
        margin: 0;
        padding: 0;
        display: flex;
        align-items: stretch;
      }
      .feature-nav a {
        display: flex;
        align-items: center;
        justify-content: flex-start;
        width: 100%;
        min-height: 60px;
        padding: 14px 18px;
        color: #e0e0e0;
        font-weight: 600;
        font-family: "Montserrat", sans-serif;
        font-size: 1em;
        text-decoration: none;
        border-bottom: 3px solid transparent;
        border-radius: 8px;
        transition: background 0.2s, color 0.2s, border 0.2s;
        background: none;
        word-break: break-word;
        text-align: left;
      }
      .feature-nav a.active,
      .feature-nav a:hover {
        color: #03dac6;
        background: #232323;
        border-bottom: 3px solid #03dac6;
      }
      @media (max-width: 900px) {
        .feature-nav ul {
          grid-template-columns: 1fr 1fr;
        }
      }
      @media (max-width: 600px) {
        .feature-nav ul {
          grid-template-columns: 1fr;
        }
        .feature-nav a {
          font-size: 0.98em;
          padding: 12px 10px;
        }
      }
      html[dir="rtl"] .feature-nav ul {
        direction: rtl;
      }
      html[dir="rtl"] .feature-nav a {
        text-align: right;
        justify-content: flex-end;
      }
    </style>
  </body>
</html>
