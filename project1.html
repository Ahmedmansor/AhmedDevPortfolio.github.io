<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title data-i18n-key="project1Page.pageTitle"></title>
    <link rel="stylesheet" href="style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Montserrat:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
  </head>

  <body id="project1-page">
    <template id="gallery-item-template">
      <div class="gallery-item">
        <p class="media-caption"></p>
        <button class="see-more-btn" data-i18n-key="common.seeMore"></button>
        <video autoplay loop muted playsinline>
          <source src="" type="video/mp4" />
          Your browser does not support the video tag.
        </video>
      </div>
    </template>

    <div class="container">
      <header class="project-detail-header">
        <div class="language-switcher">
          <button id="lang-en-btn">English</button>
          <button id="lang-ar-btn">العربية</button>
        </div>
        <h1 data-i18n-key="project1Page.headerTitle"></h1>
        <p data-i18n-key="project1Page.headerDescription"></p>
      </header>

      <main class="project-detail-content">
        <div class="feature-spotlight">
          <h4 data-i18n-key="project1Page.feature1Title"></h4>
          <p
            class="feature-description"
            data-i18n-key="project1Page.feature1Description"
          ></p>
          <div class="feature-media-gallery" id="login-gallery"></div>
        </div>
        <div class="feature-spotlight">
          <h4 data-i18n-key="project1Page.feature2Title"></h4>
          <p
            class="feature-description"
            data-i18n-key="project1Page.feature2Description"
          ></p>
          <div class="feature-media-gallery" id="registration-gallery"></div>
        </div>
        <div class="feature-spotlight">
          <h4 data-i18n-key="project1Page.feature3Title"></h4>
          <p
            class="feature-description"
            data-i18n-key="project1Page.feature3Description"
          ></p>
          <div class="feature-media-gallery" id="profiles-gallery"></div>
          <div class="side-by-side-container">
            <h5 data-i18n-key="project1Page.feature3ComparisonTitle"></h5>
            <p data-i18n-key="project1Page.feature3ComparisonDescription"></p>
            <img
              src="assets/images/all-profiles-comparison.jpg"
              alt="Side-by-side comparison"
            />
          </div>
        </div>
        <div class="feature-spotlight">
          <h4 data-i18n-key="project1Page.feature4Title"></h4>
          <p
            class="feature-description"
            data-i18n-key="project1Page.feature4Description"
          ></p>
          <div class="feature-media-gallery" id="search-filter-gallery"></div>
        </div>
        <div class="feature-spotlight">
          <h4 data-i18n-key="project1Page.feature5Title"></h4>
          <p
            class="feature-description"
            data-i18n-key="project1Page.feature5Description"
          ></p>
          <div class="feature-media-gallery" id="become-coach-gallery"></div>
        </div>
        <div class="feature-spotlight">
          <h4 data-i18n-key="project1Page.feature6Title"></h4>
          <p
            class="feature-description"
            data-i18n-key="project1Page.feature6Description"
          ></p>
          <div class="feature-media-gallery" id="session-gallery">
            <div class="gallery-item">
              <p
                class="media-caption"
                data-i18n-key="project1Page.staticImageData.sessionSync.caption"
              ></p>
              <button
                class="see-more-btn"
                data-i18n-key="common.seeMore"
              ></button>
              <img
                src="assets/images/linker-players-Joined.jpg"
                alt="Screenshot of coach's view"
              />
            </div>
          </div>
        </div>
      </main>

      <a
        href="index.html"
        class="back-to-home-link"
        data-i18n-key="common.backToHome"
      ></a>
    </div>

    <script>
      let translations = {};

      function translatePage() {
        if (!translations || Object.keys(translations).length === 0) return;
        const currentLang = localStorage.getItem("lang") || "en";
        document.documentElement.lang = currentLang;
        document.documentElement.dir = currentLang === "ar" ? "rtl" : "ltr";

        const pageId = document.body.id;
        let pageKey = pageId === "index-page" ? "indexPage" : "project1Page";

        document.querySelectorAll("[data-i18n-key]").forEach((element) => {
          const fullKey = element.getAttribute("data-i18n-key");
          let value;
          // Check for common keys first
          if (fullKey.startsWith("common.")) {
            value = translations.common[fullKey.replace("common.", "")];
          } else {
            const key = fullKey.replace(pageKey + ".", "");
            value = key
              .split(".")
              .reduce(
                (obj, k) => (obj && obj[k] !== undefined ? obj[k] : undefined),
                translations[pageKey]
              );
          }
          if (value !== undefined) element.innerHTML = value;
        });

        if (pageId === "project1-page") {
          document
            .querySelectorAll(".feature-media-gallery")
            .forEach((gallery) => (gallery.innerHTML = ""));
          const sessionGallery = document.getElementById("session-gallery");
          if (sessionGallery) {
            sessionGallery.innerHTML = `<div class="gallery-item">
                        <p class="media-caption" data-i18n-key="project1Page.staticImageData.sessionSync.caption">${translations.project1Page.staticImageData.sessionSync.caption}</p>
                        <button class="see-more-btn" data-i18n-key="common.seeMore">${translations.common.seeMore}</button>
                        <img src="assets/images/linker-players-Joined.jpg" alt="Screenshot of the coach's view" />
                    </div>`;
          }

          createGallery(
            "login-gallery",
            translations.project1Page.loginGalleryData || []
          );
          createGallery(
            "registration-gallery",
            translations.project1Page.registrationGalleryData || []
          );
          createGallery(
            "profiles-gallery",
            translations.project1Page.profilesGalleryData || []
          );
          createGallery(
            "search-filter-gallery",
            translations.project1Page.searchFilterGalleryData || []
          );
          createGallery(
            "become-coach-gallery",
            translations.project1Page.becomeCoachGalleryData || []
          );
          createGallery(
            "session-gallery",
            translations.project1Page.sessionGalleryData || []
          );
          applySeeMoreLogic();
        }
      }

      function loadLanguage(lang) {
        const oldScript = document.getElementById("lang-script");
        if (oldScript) oldScript.remove();

        const script = document.createElement("script");
        script.id = "lang-script";
        script.src = `lang/${lang}.js`;
        script.onload = () => {
          localStorage.setItem("lang", lang);
          translatePage();
        };
        script.onerror = () =>
          console.error(`Failed to load language file: ${script.src}`);
        document.head.appendChild(script);
      }

      function createGallery(containerId, data) {
        const galleryContainer = document.getElementById(containerId);
        if (!galleryContainer || !data) return;
        const CHARACTER_LIMIT = 110;
        data.forEach((itemData) => {
          // Create gallery-item div
          const itemDiv = document.createElement("div");
          itemDiv.className = "gallery-item";

          // Caption
          const captionP = document.createElement("p");
          captionP.className = "media-caption";
          captionP.innerHTML = itemData.caption;
          itemDiv.appendChild(captionP);

          // See more button only if caption is long
          if (captionP.textContent.length > CHARACTER_LIMIT) {
            const seeMoreBtn = document.createElement("button");
            seeMoreBtn.className = "see-more-btn";
            seeMoreBtn.setAttribute("data-i18n-key", "common.seeMore");
            seeMoreBtn.textContent =
              translations.common && translations.common.seeMore
                ? translations.common.seeMore
                : "See More";
            itemDiv.appendChild(seeMoreBtn);
          }

          // Video
          if (itemData.videoSrc) {
            const video = document.createElement("video");
            video.autoplay = true;
            video.loop = true;
            video.muted = true;
            video.playsInline = true;
            const source = document.createElement("source");
            source.src = itemData.videoSrc;
            source.type = "video/mp4";
            video.appendChild(source);
            video.innerHTML += "Your browser does not support the video tag.";
            itemDiv.appendChild(video);
          }
          galleryContainer.appendChild(itemDiv);
        });
      }

      function applySeeMoreLogic() {
        const CHARACTER_LIMIT = 110;
        const galleryItems = document.querySelectorAll(".gallery-item");
        galleryItems.forEach((item) => {
          const caption = item.querySelector(".media-caption");
          const button = item.querySelector(".see-more-btn");
          if (!button) return;

          if (button.hasAttribute("data-listener-added")) return;

          // Only show button if caption is long
          button.style.visibility =
            caption.textContent.length > CHARACTER_LIMIT ? "visible" : "hidden";
          caption.classList.remove("truncated");

          if (caption.textContent.length > CHARACTER_LIMIT) {
            caption.classList.add("truncated");
          }
          button.addEventListener("click", () => {
            caption.classList.toggle("truncated");
            button.textContent = caption.classList.contains("truncated")
              ? translations.common.seeMore || "See More"
              : translations.common.seeLess || "See Less";
          });
          button.setAttribute("data-listener-added", "true");
        });
      }

      function setActiveLangButton(lang) {
        const enBtn = document.getElementById("lang-en-btn");
        const arBtn = document.getElementById("lang-ar-btn");
        enBtn.classList.toggle("active", lang === "en");
        arBtn.classList.toggle("active", lang === "ar");
      }

      document.getElementById("lang-en-btn").addEventListener("click", () => {
        setActiveLangButton("en");
        loadLanguage("en");
      });
      document.getElementById("lang-ar-btn").addEventListener("click", () => {
        setActiveLangButton("ar");
        loadLanguage("ar");
      });

      // Set initial active button
      setActiveLangButton(localStorage.getItem("lang") || "en");
      loadLanguage(localStorage.getItem("lang") || "en");
    </script>
  </body>
</html>
